#!/usr/bin/env bash

domain="$(echo "$1" | grep -iPo '(https://)(www\\.)?[^/]+' | sed 's/\(https:\/\/\|www\.\)//g')" || true
trackingNum=$(echo "$1" | grep -iPo '([\d ]{10,40}|[a-z\d]{10-40})') || true

echo "input: $1"
echo "domain: $domain"
echo "trackingNum: $trackingNum"

# if you provided a url
if [ -n "$domain" ]
then
	# download big teeturtle images
	if echo "$1" | grep -iq "teeturtle.com"
	then
		outDir="$HOME/storage/downloads/TeeTurtle/"
		mkdir -p "$outDir"
		$HOME/bin/download-teeturtle "$1" "$outDir"
		termux-media-scan "$outDir"

	# download big teeturtle images
	elif echo "$1" | grep -iq "threadless.com"
	then
		outDir="$HOME/storage/downloads/$domain"
		mkdir -p "$outDir"
		$HOME/bin/download-threadless "$1" "$outDir"
		termux-media-scan "$outDir"

	# download astrobin
	elif echo "$1" | grep -iq "astrobin.com"
	then
		outDir="$HOME/storage/downloads/$domain"
		mkdir -p "$outDir"
		$HOME/bin/download-astrobin "$1" "$outDir"
		termux-media-scan "$outDir"

	# download images off this unknown page
	else
		outDir="$HOME/storage/downloads/$domain"
		mkdir -p "$outDir"
		$HOME/bin/download-page-images "$1" "$outDir"
		termux-media-scan "$outDir"
	fi
# google the tracking number
elif [ -n "$trackingNum" ]
then
	# termux-open-url "https://www.google.com/search?q=$trackingNum"
	termux-open-url "https://parcelsapp.com/en/tracking/$trackingNum"
else
	error="I have no idea what this is."
	echo "$error"
	termux-toast "$error"
	exit 1
fi
